<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<title>Same Origin Onion Certificates</title>
<meta content="Alec Muffett" name="author">
<meta content="
       WORK IN PROGRESS - SEPTEMBER 2019 
       Onion networking   offers technical features which obviate
many of the risks upon which led to the development of our modern
Certificate Authority Public Key Infrastructure; as an increasingly
popular technology for networking with strong trust requirements,
onion networking would benefit from easier access to TLS certificates
for HTTPS use. 
       At the moment only EV certificates are available for onion network
addresses, although DV certificates are under discussion.  This
document defines a third mechanism - SOOC: Same Origin Onion
Certificates - which would enable real-time, client-side validation of
per-onion-address TLS certificates, fully equivalent (in defined
circumstances) to validation of a certificate trust chain, but
involving none of third parties, trust chains, or financial cost. 
    " name="description">
<meta content="xml2rfc 2.23.1" name="generator">
<meta content="tor" name="keyword">
<meta content="onion" name="keyword">
<meta content="tls" name="keyword">
<meta content="ssl" name="keyword">
<link href="draft-muffett-same-origin-onion-certificates.xml" type="application/rfc+xml" rel="alternate">
<link href="#copyright" rel="license">
<style type="text/css">/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
  z-index: 2;
}
a[href] {
  color: #3E8EDE;
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #777;
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #b76427;
  background-color: rgba(249, 232, 105, 0.3);
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: rgba(249, 232, 105, 0.3);
  border-radius: 3px;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.art-text pre {
  line-height: 1.12;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Avoid wrapping of URLs in references */
.references a {
  white-space: nowrap;
}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
</style>
<link href="rfc-local.css" type="text/css" rel="stylesheet">
</head>
<body>
<script>
window.addEventListener('load',addMetadata);

async function addMetadata() {

  // Copy all CSS rules for "#identifiers" to "#metadata"
    try {
        const cssRules = document.styleSheets[0].cssRules;
        for (let i = 0; i < cssRules.length; i++) {
            if (/#identifiers/.exec(cssRules[i].selectorText)) {
                const rule = cssRules[i].cssText.
                             replace('#identifiers','#metadata');
                document.styleSheets[0].
                        insertRule(rule, document.styleSheets[0].cssRules.length);
            }
        }
    } catch (e) {
        console.log(e);
    }

  // Retrieve the "metadata" element from the document
    const div = document.getElementById('metadata');
    if (!div) {
        console.log("Could not locate metadata <div> element");
        return;
    }
    div.style.background='#eee';

  // Insert the metadata block
  // [TODO: make this more sophisticated and linkify the values]
    try {
        const jsonFile = document.URL.replace(/html$/,'json');
        const response = await fetch(jsonFile);
        const metadata = (await response.json())[0];

        const label = {
            'STATUS': 'Status',
            'OBSOLETES': 'Obsoletes',
            'OBSOLETED-BY': 'Obsoleted By',
            'UPDATES': 'Updates',
            'UPDATED-BY': 'Updated By',
            'SEE-ALSO': 'See Also',
            'ERRATA-URL': 'Errata',
        };

        let metadataHTML = "<dl style='overflow:hidden'>";
        ['STATUS', 'OBSOLETES', 'OBSOLETED-BY', 'UPDATES',
         'UPDATED-BY', 'SEE-ALSO', 'ERRATA-URL'].forEach(key => {
            if (metadata[key]) {
                metadataHTML += `<dt>${label[key]}:</dt><dd>${metadata[key]}</dd>`;
            }
        })
                metadataHTML += "</dl>";
        div.innerHTML = metadataHTML;

    } catch (e) {
        console.log(e);
    }
}
</script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">sooc</td>
<td class="right">October 2019</td>
</tr></thead>
<tfoot><tr>
<td class="left">Muffett</td>
<td class="center">Expires 22 April 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Transport Layer Security</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-muffett-same-origin-onion-certificates-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2019-10-20" class="published">20 October 2019</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-04-22">22 April 2020</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">A. Muffett</div>
<div class="org">Independent</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Same Origin Onion Certificates</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">WORK IN PROGRESS - SEPTEMBER 2019<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2">Onion networking <span>[<a href="#RFC7686" class="xref">RFC7686</a>]</span> offers technical features which obviate
many of the risks upon which led to the development of our modern
Certificate Authority Public Key Infrastructure; as an increasingly
popular technology for networking with strong trust requirements,
onion networking would benefit from easier access to TLS certificates
for HTTPS use.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
<p id="section-abstract-3">At the moment only EV certificates are available for onion network
addresses, although DV certificates are under discussion.  This
document defines a third mechanism - SOOC: Same Origin Onion
Certificates - which would enable real-time, client-side validation of
per-onion-address TLS certificates, fully equivalent (in defined
circumstances) to validation of a certificate trust chain, but
involving none of third parties, trust chains, or financial cost.<a href="#section-abstract-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 22 April 2020.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2019 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-boilerplate.3">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.3-1.1">
            <p id="section-boilerplate.3-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-boilerplate.3-1.1.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.3-1.1.2.1">
                <p id="section-boilerplate.3-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-onion-networking-compared-t" class="xref">Onion Networking compared to TLS PKI</a><a href="#section-boilerplate.3-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.3-1.2">
            <p id="section-boilerplate.3-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-sooc-in-context" class="xref">SOOC In Context</a><a href="#section-boilerplate.3-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.3-1.3">
            <p id="section-boilerplate.3-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-sooc-conditions-and-technic" class="xref">SOOC Conditions and Technical Definition</a><a href="#section-boilerplate.3-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.3-1.4">
            <p id="section-boilerplate.3-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-sooc-use-cases" class="xref">SOOC Use Cases</a><a href="#section-boilerplate.3-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.3-1.4.2.1">
                <p id="section-boilerplate.3-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-sooc-to-complement-not-repl" class="xref">SOOC to complement, not replace, EV (and perhaps DV)</a><a href="#section-boilerplate.3-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.3-1.4.2.2">
                <p id="section-boilerplate.3-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-sooc-and-ev-certificates" class="xref">SOOC and EV Certificates</a><a href="#section-boilerplate.3-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.3-1.4.2.3">
                <p id="section-boilerplate.3-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-sooc-and-dv-certificates" class="xref">SOOC and DV Certificates</a><a href="#section-boilerplate.3-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.3-1.4.2.4">
                <p id="section-boilerplate.3-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-sooc-and-letsencrypt" class="xref">SOOC and LetsEncrypt</a><a href="#section-boilerplate.3-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.3-1.4.2.5">
                <p id="section-boilerplate.3-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-sooc-and-hsts" class="xref">SOOC and HSTS</a><a href="#section-boilerplate.3-1.4.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.3-1.4.2.6">
                <p id="section-boilerplate.3-1.4.2.6.1"><a href="#section-4.6" class="xref">4.6</a>.  <a href="#name-sooc-and-certificate-transp" class="xref">SOOC and Certificate Transparency</a><a href="#section-boilerplate.3-1.4.2.6.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.3-1.5">
            <p id="section-boilerplate.3-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-sooc-edge-cases-and-sooc-ev" class="xref">SOOC Edge-Cases, and "SOOC-EV"</a><a href="#section-boilerplate.3-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-boilerplate.3-1.5.2.1">
                <p id="section-boilerplate.3-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-advanced-mitigations-sooc-e" class="xref">Advanced Mitigations: SOOC-EV</a><a href="#section-boilerplate.3-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc ulEmpty" id="section-boilerplate.3-1.5.2.2">
                <p id="section-boilerplate.3-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-reciprocal-attack-shared-to" class="xref">Reciprocal Attack: Shared Tor Gateways?</a><a href="#section-boilerplate.3-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.3-1.6">
            <p id="section-boilerplate.3-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-linkfarm-tbd" class="xref">Linkfarm TBD</a><a href="#section-boilerplate.3-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.3-1.7">
            <p id="section-boilerplate.3-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-boilerplate.3-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc ulEmpty" id="section-boilerplate.3-1.8">
            <p id="section-boilerplate.3-1.8.1"><a href="#section-appendix.a" class="xref"></a>  <a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-boilerplate.3-1.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">There are many reasons why the Internet and WWW are equipped with a
public key infrastructure (PKI), and the PKI offers many features and
benefits; however its inarguable primary function is to provide a form
of identity assurance, that when a person types a hostname such as
"www.example.com" into a web browser's URL bar, they should have some
reasonable expectation - and ideally a strong guarantee - that the
network-connected-service from which they are eventually served
content is one that would commonly be accepted as being capable,
permitted and expected to serve content which people who own the
"www.example.com" intentionally supply.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The PKI mechanism has evolved to provide such identity assurance in a
heavily-layered network environment which lacks overarching trust
mechanisms and which is riven with potential for attack at (or:
across) different layers.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">For instance:<a href="#section-1-3" class="pilcrow">¶</a></p>
<ul>
<li id="section-1-4.1">
          <p id="section-1-4.1.1">ARP: first-hop, last-hop, or indeed any other hop may be hijacked
with spoofed layer-2 address resolution; indeed some firewall
devices rely upon this mechanism for their function<a href="#section-1-4.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-4.2">
          <p id="section-1-4.2.1">TCP: traffic may be blocked, dropped, modified, injected, or
redirected to fake machines<a href="#section-1-4.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-4.3">
          <p id="section-1-4.3.1">BGP: bearer traffic and entire flows may be blocked, dropped, or
redirected to fake machines<a href="#section-1-4.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-4.4">
          <p id="section-1-4.4.1">DNS: namespaces can be domain-jacked, responses can be forged,
cache-poisoned, or simply tampered-with in flight, also homoglyph
"lookalike" domains (eg: www.examp1e.com) are also possible<a href="#section-1-4.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-5">The benefits of any intra-layer trust mechanism - eg: IPsec
Authentication Header (AH) &amp; Encapsulating Security Payload (ESP) at
layer-3 - are typically isolated and not known to other layers of the
stack - eg: the web browser - which therefore cannot take
consideration of their benefits.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">In this environment our HTTPS ecosystem has evolved in the expectation
of ignoring transport security - such as IPsec - and has instead has
built its own, where a server's "identity" may be provisionally
bootstrapped by DNS resolution of of a layer-3 IP address, however
that identity <span class="bcp14">MUST</span> be proven by proof-of-possession of a
cryptographic key that has been blessed by a trusted authority as
pertaining to "www.example.com".<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">The extent of such blessing is variable: for DV certificates the
requisite test is one of consistent DNS resolution (eg: LetsEncrypt);
and for EV certificates there are additional, expensive, and arguably
superfluous corporate identity checks.<a href="#section-1-7" class="pilcrow">¶</a></p>
<div id="onion-networking-compared-to-tls-pki">
<section id="section-1.1">
        <h3 id="name-onion-networking-compared-t">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-onion-networking-compared-t" class="section-name selfRef">Onion Networking compared to TLS PKI</a>
        </h3>
<p id="section-1.1-1">Tor "onion networking" is an alternate, software-defined, flat layer-3
network space which exists on top of TCP/IP and the rest of the
internet.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Onion addresses are either hashes of (in 80-bit version 2 addresses),
or are literally and entirely (in 256-bit version 3 addresses) the
public keys which sign all data that pertains to communication with
that address.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">Like most cryptographic keys, onion addresses appear essentially to be
strings of random bits, although it's possible via "mining" to
eventually generate one which appears meaningful to human beings, eg:
"facebookcorewwwi.onion"<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">For purposes of PKI, the most interesting aspect of onion addresses is
their textual representation; unlike IPv4's "dotted quads" or IPv6's
colon-separated hexadecimal, onion addresses are required (<span>[<a href="#RFC7686" class="xref">RFC7686</a>]</span>
section 1) to be written in a DNS-compatible text format: as base-32
encoded binary with addition of the IANA Special-Use Domain Name
suffix, ".onion", and they are interpreted ignoring any labels other
than the rightmost two.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">Thus: the onion address "www.exampleonionaddr.onion" would be a
version 2 onion address representing a server that possesses a
1024-bit RSA public key which has an 80-bit-truncated SHA-1 hash of
0x25c0c7ac8e6a1cd00c71 (<span>[<a href="#RFC3548" class="xref">RFC3548</a>]</span> base32 "EXAMPLEONIONADDR"); and
where the "www" prefix hostname/subdomain will ignored, although if
specified it will be passed onward in an HTTPS "Host:" header.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6">This representation pierces all of the layers of the network stack,
and in one encoding it addresses most of the problems which the TLS
PKI stack has gradually evolved to solve for TCP/IP:<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<ul>
<li id="section-1.1-7.1">
            <p id="section-1.1-7.1.1">There is no DNS name resolution service in onion networking, and in
fact <span>[<a href="#RFC7686" class="xref">RFC7686</a>]</span> section 2 specifies that there <span class="bcp14">MUST NOT</span> be
overlap with DNS; this is an important point to which we will return
later.<a href="#section-1.1-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-1.1-7.2">
            <p id="section-1.1-7.2.1">What the user types into the browser bar will defacto prove what
site they are connected to; the Tor Onion Network at layer 3 will
consequently assert "proof-of-possession of a cryptographic key"
that will correspond absolutely to the remote service; this is
isomorphic to the model of a TLS certificate proving the identity of
a webserver.<a href="#section-1.1-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-1.1-7.3">
            <p id="section-1.1-7.3.1">Because onion addresses are layer-3 addresses, there is no concept
of "subdomains" nor of "hostnames" and therefore any such
information is considered "advisory"; however in this format they
are backwards compatible in a way that "subdomains" for "dotted
quad" addresses would not be, eg: "www.192.168.1.1"<a href="#section-1.1-7.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-1.1-7.4">
            <p id="section-1.1-7.4.1">All other connectivity redirections or "hijacks" are inhibited by
the Tor network stack.<a href="#section-1.1-7.4.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="sooc-in-context">
<section id="section-2">
      <h2 id="name-sooc-in-context">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-sooc-in-context" class="section-name selfRef">SOOC In Context</a>
      </h2>
<p id="section-2-1">As described above, the security characteristics and protections of
layer-3 networking (eg: IPsec) are generally not visible to HTTPS
applications at layer-7, and therefore cannot be relied upon.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">However: the encoding of onion addresses explicitly solves this problem:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul>
<li id="section-2-3.1">
          <p id="section-2-3.1.1">The connection <span class="bcp14">MUST</span> be an onion connection, because it was made
using Tor-capable software, and because the ".onion" Special Use
Domain Name is reserved for that purpose.<a href="#section-2-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-3.2">
          <p id="section-2-3.2.1">The connection <span class="bcp14">MUST</span> be to "exampleonionaddr.onion" because the
Tor network will not permit otherwise.<a href="#section-2-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-2-3.3">
          <p id="section-2-3.3.1">Any subdomain or hostname is subordinate to the fact that the
connection is made to "exampleonionaddr.onion", because (as a
layer-3 address) there are actually no such things as "subdomains"
or "hostnames", and thus this information is purely advisory, or for
compatability.<a href="#section-2-3.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-4">Therefore it is possible for a client to assure itself - when
presented with a TLS certificate for "www.exampleonionaddr.onion" - to
assure itself that it is genuinely and authoritatively connected to
"exampleonionaddr.onion" by simply performing a string comparison with
the hostname to which is it connected - without any reference to a
certificate authority trust chain nor any other third party resource.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">This observation is the basis of "Same Origin Onion Certificate"
checking; that onion sites may offer (eg: homebrew DV-compliant) TLS
certificates which correspond solely and uniquely to themselves, and
under those limited circumstances the client may skip the certificate
chain checks that might otherwise be required to validate identity.<a href="#section-2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sooc-conditions-and-technical-definition">
<section id="section-3">
      <h2 id="name-sooc-conditions-and-technic">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-sooc-conditions-and-technic" class="section-name selfRef">SOOC Conditions and Technical Definition</a>
      </h2>
<p id="section-3-1">TODO<a href="#section-3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sooc-use-cases">
<section id="section-4">
      <h2 id="name-sooc-use-cases">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-sooc-use-cases" class="section-name selfRef">SOOC Use Cases</a>
      </h2>
<p id="section-4-1">TODO<a href="#section-4-1" class="pilcrow">¶</a></p>
<div id="sooc-to-complement-not-replace-ev-and-perhaps-dv">
<section id="section-4.1">
        <h3 id="name-sooc-to-complement-not-repl">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-sooc-to-complement-not-repl" class="section-name selfRef">SOOC to complement, not replace, EV (and perhaps DV)</a>
        </h3>
<p id="section-4.1-1">TODO<a href="#section-4.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sooc-and-ev-certificates">
<section id="section-4.2">
        <h3 id="name-sooc-and-ev-certificates">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-sooc-and-ev-certificates" class="section-name selfRef">SOOC and EV Certificates</a>
        </h3>
<p id="section-4.2-1">TODO<a href="#section-4.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sooc-and-dv-certificates">
<section id="section-4.3">
        <h3 id="name-sooc-and-dv-certificates">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-sooc-and-dv-certificates" class="section-name selfRef">SOOC and DV Certificates</a>
        </h3>
<p id="section-4.3-1">TODO<a href="#section-4.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sooc-and-letsencrypt">
<section id="section-4.4">
        <h3 id="name-sooc-and-letsencrypt">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-sooc-and-letsencrypt" class="section-name selfRef">SOOC and LetsEncrypt</a>
        </h3>
<p id="section-4.4-1">TODO<a href="#section-4.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sooc-and-hsts">
<section id="section-4.5">
        <h3 id="name-sooc-and-hsts">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-sooc-and-hsts" class="section-name selfRef">SOOC and HSTS</a>
        </h3>
<p id="section-4.5-1">TODO<a href="#section-4.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sooc-and-certificate-transparency">
<section id="section-4.6">
        <h3 id="name-sooc-and-certificate-transp">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-sooc-and-certificate-transp" class="section-name selfRef">SOOC and Certificate Transparency</a>
        </h3>
<p id="section-4.6-1">TODO<a href="#section-4.6-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sooc-edge-cases-and-sooc-ev">
<section id="section-5">
      <h2 id="name-sooc-edge-cases-and-sooc-ev">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-sooc-edge-cases-and-sooc-ev" class="section-name selfRef">SOOC Edge-Cases, and "SOOC-EV"</a>
      </h2>
<p id="section-5-1">It is necessary to recognise that there is one "weak" spot in the
assertion that string comparison is sufficient to prove the binding
between an Onion Address and a SSL Certificate Subject Alt-Name, and
that is in a scenario where the content webserver has been been
deployed on one (or more) machines which are separate from the machine
that terminates (ie: hosts) the Onion Address AND where the Tor daemon
makes direct TCP connections onwards to those servers.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The threat is: if a malicious actor can present themselves to the Tor
daemon as being the IP address of the server-side webserver, or
load-balancer, or as being one of the load-balanced server tier, then
under SOOC the malicious actor could create a certificate that would
permit them to impersonate a genuine SSL-certificate-enabled system
amongst that cloud.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">This is a question of trust boundaries and real world deployments; at
the moment the "onion networking" service space is broadly comprised
of unencrypted HTTP, and as such any typical onion service deployment
which uses a load-balancer would already be at risk of this attack.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">Contra: any onion site which uses a "rewriter" reverse-proxy (e.g.:
New York Times, Propublica) is typically NOT at risk from this attack,
because the inbound HTTPS request is terminated on the "onion" host,
immediately rewritten in terms of the address of the upstream service,
and is passed onward as a fresh HTTPS connection.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">As far as I am aware, the only onion service deployment where this
would be a potential issue, is at Facebook; and if the Facebook devops
team are at risk of someone interposing a fake server and server
certificate into their infrastructure, then they have bigger problems
than mere onion service impersonation.<a href="#section-5-5" class="pilcrow">¶</a></p>
<div id="advanced-mitigations-sooc-ev">
<section id="section-5.1">
        <h3 id="name-advanced-mitigations-sooc-e">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-advanced-mitigations-sooc-e" class="section-name selfRef">Advanced Mitigations: SOOC-EV</a>
        </h3>
<p id="section-5.1-1">Generally at this point, enthusiastic cryptographers will point at
Version 3 Onion Addresses and note that they are actual public keys,
and "couldn't they just sign the SOOC Certificate, and the browser
would check the signature, and that would be the end of the problem?"<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">They are correct to say this, however this raises two problems:<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal" id="section-5.1-3">
          <li id="section-5.1-3.1">
            <p id="section-5.1-3.1.1">This would orphan Version 2 Onion addresses without SOOC, expressly
against the intent of this document.<a href="#section-5.1-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.1-3.2">
            <p id="section-5.1-3.2.1">The Version 3 Onion addresses are (by Tor policy) never used to
sign anything <a href="https://gitweb.torproject.org/torspec.git/tree/rend-spec-v3.txt#n557">https://gitweb.torproject.org/torspec.git/tree/rend-spec-v3.txt#n557</a><a href="#section-5.1-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-5.1-4">Quote:<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<blockquote id="section-5.1-5">
          <p id="section-5.1-5.1">Master (hidden service) identity key -- A master signing keypair
used as the identity for a hidden service. This key is long term and
not used on its own to sign anything; it is only used to generate
blinded signing keys as described in [KEYBLIND]<a href="#section-5.1-5.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-5.1-6">In Version 3 Onion Addressing, the address-key is used to derive
short-term, time-locked, "blinded" keys in a fixed manner that can be
replicated by a client which wishes to connect to the master onion
address.  The blinded keys are used to sign connection information
that is loaded up into the "HSDir" distributed hash-table that
describes Onion connectivity.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1-7">Ergo: to implement a form of "Extended Validation" certificate
extension that would bind a TLS certificate to an onion address, the
certificate would have to contain the onion public key (for V2) or a
blinded public key for a reasonable timestamp (for V3), and this
public key would be used to validate a hash of some portion of the
certificate, all in order to address this niche deployment risk.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">This is certainly possible to achieve, and is fairly straightforward,
however it is a tremendous hassle for a niche risk, and I believe that
it should not be an progress to implmenting SOOC without implementing
these "Extended Validation"-type checks.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">My rationale for the deferring SOOC-EV development is - apart from the
nicheness aspect - bolstered by the observation that "Appendix F" of
CA/B-Forum Ballot 144:<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<p id="section-5.1-10"><a href="https://cabforum.org/2015/02/18/ballot-144-validation-rules-dot-onion-names/">https://cabforum.org/2015/02/18/ballot-144-validation-rules-dot-onion-names/</a><a href="#section-5.1-10" class="pilcrow">¶</a></p>
<p id="section-5.1-11">Describes the "CAB Forum Tor Service Descriptor Hash Extension", a
hash of the V2 Onion Public Key which Certificate Authorities are
obliged to bind into the EV TLS Onion Certificates that they issue,
ostensibly to both link the onion public key more tightly to the TLS
certificate in the event that a colliding V2 Onion address is
generated, but also to protect against the above described kinds of
attack.<a href="#section-5.1-11" class="pilcrow">¶</a></p>
<p id="section-5.1-12">I observe that no client code is implemented to check for this
condition, to the extent that when Digicert misissued a certificate
without the extension (compare <a href="https://crt.sh/?id=240277340">https://crt.sh/?id=240277340</a> with
<a href="https://crt.sh/?id=241547157)">https://crt.sh/?id=241547157)</a> nobody actually noticed.<a href="#section-5.1-12" class="pilcrow">¶</a></p>
<p id="section-5.1-13">As such, I don't believe that this attack is worthy of consideration
yet, especially as it is within the power of the service provider to
mitigate in alternative ways, and in any case we may still evolve
towards SOOC-EV as the the technology matures.<a href="#section-5.1-13" class="pilcrow">¶</a></p>
<p id="section-5.1-14">To be clear: I believe that SOOC-EV should probably be done.  I also
firmly do not believe that it is a pre-requisite, nor is it necessary
to do it "now" or to block SOOC until it is done.  Apart from the
reasons above, there is likely still some need for V3 Onion Addresses
to mature in deployments for one or two years.<a href="#section-5.1-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="reciprocal-attack-shared-tor-gateways">
<section id="section-5.2">
        <h3 id="name-reciprocal-attack-shared-to">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-reciprocal-attack-shared-to" class="section-name selfRef">Reciprocal Attack: Shared Tor Gateways?</a>
        </h3>
<p id="section-5.2-1">Having comprehended the above, there is also obviously a reciprocal
risk which can be stated:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<ul>
<li id="section-5.2-2.1">
            <p id="section-5.2-2.1.1">What about shared onion gateways? What if many people use one Tor
proxy to access Tor? One could interpose a fake SOCKS5
man-in-the-middle and respond to Onion connection requests with a
fake SOOC TLS certificate!<a href="#section-5.2-2.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-3">The response to which, again, is that although such may happen
experimentally, the overwhelming means by which people access Tor is
by using a local client over localhost, one (or more) per user. At the
"client" end, access to the Tor proxy is within the local trust
boundary, where worse things can happen.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="linkfarm-tbd">
<section id="section-6">
      <h2 id="name-linkfarm-tbd">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-linkfarm-tbd" class="section-name selfRef">Linkfarm TBD</a>
      </h2>
<p id="section-6-1">For more on Onion Networking as a layer-3 network, see:
<a href="https://www.youtube.com/watch?v=pebRZyg_bh8">https://www.youtube.com/watch?v=pebRZyg_bh8</a><a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">IANA Special-Use Domain Names
<a href="https://www.iana.org/assignments/special-use-domain-names/special-use-domain-names.xhtml">https://www.iana.org/assignments/special-use-domain-names/special-use-domain-names.xhtml</a><a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Facebook Onion Announcement
<a href="https://www.facebook.com/notes/protect-the-graph/making-connections-to-facebook-more-secure/1526085754298237/">https://www.facebook.com/notes/protect-the-graph/making-connections-to-facebook-more-secure/1526085754298237/</a><a href="#section-6-3" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-informative-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="RFC3548">[RFC3548]</dt>
      <dd>
<span class="refAuthor">Josefsson, S., Ed.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 3548</span>, <span class="seriesInfo">DOI 10.17487/RFC3548</span>, <time datetime="2003-07">July 2003</time>
          <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc3548">https://www.rfc-editor.org/info/rfc3548</a>&gt;</span>. </dd>
<dt id="RFC7686">[RFC7686]</dt>
    <dd>
<span class="refAuthor">Appelbaum, J.</span><span class="refAuthor"> and A. Muffett</span>, <span class="refTitle">"The ".onion" Special-Use Domain Name"</span>, <span class="seriesInfo">RFC 7686</span>, <span class="seriesInfo">DOI 10.17487/RFC7686</span>, <time datetime="2015-10">October 2015</time>
          <span>, &lt;<a href="https://www.rfc-editor.org/info/rfc7686">https://www.rfc-editor.org/info/rfc7686</a>&gt;</span>. </dd>
</dl>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Alec Muffett</span></div>
<div dir="auto" class="left"><span class="org">Independent</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:alec.muffett@gmail.com" class="email">alec.muffett@gmail.com</a>
</div>
</address>
</section>
</div>
<script>var toc = document.getElementById("toc");
var tocToggle = toc.querySelector("h2");
var tocNav = toc.querySelector("nav");

// mobile menu toggle
tocToggle.onclick = function(event) {
    if (window.innerWidth < 1024) {
 var tocNavDisplay = tocNav.currentStyle ? tocNav.currentStyle.display : getComputedStyle(tocNav, null).display;
 if (tocNavDisplay == "none") {
     tocNav.style.display = "block";
 } else {
     tocNav.style.display = "none";
 }
    }
}

// toc anchor scroll to anchor
tocNav.addEventListener("click", function (event) {
    event.preventDefault();
    if (event.target.nodeName == 'A') {
 if (window.innerWidth < 1024) {
     tocNav.style.display = "none";
 }
 var href = event.target.getAttribute("href");
 var anchorId = href.substr(1);
 var anchor =  document.getElementById(anchorId);
 anchor.scrollIntoView(true);
 window.history.pushState("","",href);
    }
});

// switch toc mode when window resized
window.onresize = function () {
    if (window.innerWidth < 1024) {
 tocNav.style.display = "none";
    } else {
 tocNav.style.display = "block";
    }
}
</script>
</body>
</html>
